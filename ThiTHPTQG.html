<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kỳ Thi Tốt nghiệp THPT 2026 - Đa năng</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .screen {
            display: none;
            min-height: 100vh;
        }
        .active-screen {
            display: flex;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .login-card {
            width: 100%;
            max-width: 450px;
            padding: 2.5rem;
        }
        .subject-card {
            width: 100%;
            max-width: 1100px;
        }
        .exam-panel {
            max-height: calc(100vh - 8rem);
            overflow-y: auto;
        }
        .question-nav-item {
            cursor: pointer;
            transition: all 0.2s;
        }
        .question-nav-item.active {
            background-color: #3b82f6;
            color: white;
            font-weight: 700;
        }
        .question-nav-item.answered {
            background-color: #10b981;
            color: white;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #f3f4f6;
            color: #1f2937;
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background-color: #e5e7eb;
        }
        #question-nav::-webkit-scrollbar {
            display: none;
        }
        #question-nav {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .question-option label {
            display: block;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .question-option label:hover {
            background-color: #f3f4f6;
        }
        .question-option input:checked + label {
            background-color: #dbeafe;
            border-color: #3b82f6;
            font-weight: 600;
        }
        .result-box {
            border: 2px solid #065f46;
        }
        .section-title {
            background-color: #e0f2fe;
            color: #0c4a6e;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        /* Style cho modal */
        .modal {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transform: translateY(-50px);
            transition: transform 0.3s ease-in-out;
        }
        .modal.open .modal-content {
            transform: translateY(0);
        }
        @media (max-width: 768px) {
            .exam-layout {
                flex-direction: column;
            }
            .question-content {
                width: 100%;
                padding-right: 0;
            }
            .question-navigation {
                width: 100%;
                border-left: none;
                border-top: 1px solid #e5e7eb;
                margin-top: 1rem;
                padding-top: 1rem;
            }
            .question-nav-item {
                width: 48px;
                height: 48px;
            }
            .login-card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>

    <!-- 1. GIAO DIỆN ĐĂNG NHẬP -->
    <div id="login-screen" class="screen active-screen items-center justify-center p-4">
        <div class="card login-card text-center">
            <div class="mb-6">
                <img src="https://placehold.co/100x100/F0F0F0/888?text=Bộ+GDĐT" alt="Logo Bộ GDĐT" class="mx-auto mb-4">
                <h1 class="text-xl font-bold text-gray-800">CỤC QUẢN LÝ CHẤT LƯỢNG</h1>
                <h2 class="text-lg font-medium text-gray-600">(dành cho thí sinh & Admin)</h2>
            </div>
            
            <h3 class="text-2xl font-bold mb-6 text-gray-700">ĐĂNG NHẬP HỆ THỐNG</h3>
            
            <form id="login-form">
                <div class="mb-4 text-left">
                    <label for="ma_thi_sinh" class="block text-sm font-medium text-gray-700">Mã số/SBD *</label>
                    <input type="text" id="ma_thi_sinh" name="ma_thi_sinh" placeholder="SBD (Thí sinh) hoặc Mã Admin (22122007)" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <div class="mb-4 text-left">
                    <label for="ho_ten" class="block text-sm font-medium text-gray-700">Họ và tên / Tên đăng nhập *</label>
                    <input type="text" id="ho_ten" name="ho_ten" placeholder="Nhập tên của bạn (tùy ý)" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <div class="mb-6 text-left">
                    <label for="mat_khau" class="block text-sm font-medium text-gray-700">Mật khẩu *</label>
                    <input type="password" id="mat_khau" name="mat_khau" placeholder="Mật khẩu thí sinh (HOA2026T12) hoặc Admin" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <p id="login-error" class="text-red-500 text-sm mt-1 hidden">Thông tin đăng nhập không hợp lệ.</p>
                </div>
                <div class="mb-6 text-left">
                    <label for="dot_thi" class="block text-sm font-medium text-gray-700">Đợt thi *</label>
                    <select id="dot_thi" name="dot_thi" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <option>Kỳ thi tốt nghiệp THPT 2026</option>
                    </select>
                </div>
                <button type="button" onclick="login()" class="btn-primary w-full py-3 text-lg">Đăng nhập</button>
            </form>

            <p class="mt-8 text-xs text-gray-400">© Bản quyền thuộc Cục Quản lý chất lượng, Bộ Giáo dục và Đào tạo</p>
        </div>
    </div>

    <!-- 2. GIAO DIỆN CHỌN ĐỀ THI (THÍ SINH) -->
    <div id="subject-selection-screen" class="screen items-center justify-center p-4">
        <div class="card subject-card p-6">
            <h1 class="text-center text-3xl font-bold mb-8 text-gray-800">KỲ THI TỐT NGHIỆP THPT 2026</h1>
            
            <!-- THÔNG TIN THÍ SINH & HỘI ĐỒNG THI (ĐỂ TRỐNG) -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h2 class="font-bold text-lg mb-2 text-blue-800">THÔNG TIN THÍ SINH</h2>
                    <p class="text-sm"><span class="font-medium">Họ và tên:</span> <span id="info-ho_ten">...</span></p>
                    <p class="text-sm"><span class="font-medium">Ngày sinh:</span> <input type="text" placeholder="Tự nhập (VD: 09/12/2002)" class="w-full bg-transparent border-b border-blue-200 focus:border-blue-500 outline-none"></p>
                    <p class="text-sm"><span class="font-medium">Ca thi:</span> <input type="text" value="8" class="w-10 bg-transparent border-b border-blue-200 focus:border-blue-500 outline-none"></p>
                    <p class="text-sm mt-2"><span class="font-medium">SBD:</span> <span id="info-sbd">...</span></p>
                    <p class="text-sm"><span class="font-medium">Giới tính:</span> <input type="text" placeholder="Tự nhập (VD: Nữ)" class="w-full bg-transparent border-b border-blue-200 focus:border-blue-500 outline-none"></p>
                </div>
                <div class="p-4 bg-green-50 rounded-lg">
                    <h2 class="font-bold text-lg mb-2 text-green-800">HỘI ĐỒNG THI</h2>
                    <p class="text-sm"><span class="font-medium">Hội đồng thi:</span> <input type="text" value="Sở GDĐT Hà Nội" class="w-full bg-transparent border-b border-green-200 focus:border-green-500 outline-none"></p>
                    <p class="text-sm"><span class="font-medium">Điểm thi:</span> <input type="text" value="THPT Trần Hưng Đạo" class="w-full bg-transparent border-b border-green-200 focus:border-green-500 outline-none"></p>
                    <p class="text-sm"><span class="font-medium">Phòng thi:</span> <input type="text" value="Phòng 1" class="w-full bg-transparent border-b border-green-200 focus:border-green-500 outline-none"></p>
                </div>
            </div>

            <!-- DANH SÁCH MÔN THI MỞ RỘNG -->
            <div class="p-6 bg-gray-50 rounded-lg">
                <h2 class="font-bold text-xl mb-4 text-gray-800">DANH SÁCH MÔN THI</h2>
                <div id="subject-list" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">
                    <!-- Nội dung sẽ được tạo ra bằng JavaScript -->
                </div>
            </div>
            
            <div class="text-center mt-6">
                <button onclick="changeScreen('login-screen')" class="btn-secondary px-6">Quay lại</button>
            </div>
        </div>
    </div>

    <!-- 2B. GIAO DIỆN ADMIN -->
    <div id="admin-screen" class="screen flex-col p-4">
        <div class="max-w-7xl mx-auto w-full">
            <h1 class="text-3xl font-bold mb-4 text-blue-700">HỆ THỐNG QUẢN LÝ ADMIN</h1>
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Chào mừng, Admin Hóa học</h2>
                <button onclick="changeScreen('login-screen')" class="btn-secondary">Đăng xuất</button>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                <!-- Quản lý đề thi (Placeholder) -->
                <div class="card p-4 bg-yellow-50">
                    <h3 class="font-bold text-lg mb-2 text-yellow-800">1. Quản lý Đề thi (Hóa học)</h3>
                    <p class="text-sm text-gray-700">Đề thi đang sử dụng: Đề Hóa tháng 12 (28 câu).</p>
                    <button class="btn-primary mt-2 w-full py-2 bg-yellow-600 hover:bg-yellow-700">Tạo/Sửa Đáp án</button>
                </div>

                <!-- Thêm Thí sinh (Placeholder) -->
                <div class="card p-4 bg-green-50">
                    <h3 class="font-bold text-lg mb-2 text-green-800">2. Thêm Thí sinh</h3>
                    <p class="text-sm text-gray-700">Sử dụng form đăng nhập Thí sinh để tạo tài khoản mới (Mật khẩu: HOA2026T12).</p>
                    <button class="btn-primary mt-2 w-full py-2 bg-green-600 hover:bg-green-700" onclick="alert('Tính năng thêm đề thi phức tạp (cần backend) đã được mô phỏng. Admin có thể sửa đổi dữ liệu đề thi trong code.')">Thêm đề thi mới (Mô phỏng)</button>
                </div>

                <!-- Thống kê điểm (Placeholder) -->
                <div class="card p-4 bg-red-50">
                    <h3 class="font-bold text-lg mb-2 text-red-800">3. Reset Dữ liệu</h3>
                    <p class="text-sm text-gray-700">Xóa toàn bộ dữ liệu thí sinh và điểm số trong hệ thống.</p>
                    <button class="btn-primary mt-2 w-full py-2 bg-red-600 hover:bg-red-700" onclick="resetTestData()">Reset Dữ liệu Thí sinh</button>
                </div>
            </div>

            <!-- Danh sách Thí sinh & Điểm số -->
            <div class="card p-6 mt-6">
                <h3 class="font-bold text-xl mb-4 text-gray-800">DANH SÁCH THÍ SINH & KẾT QUẢ THI (Môn Hóa học)</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Họ và tên</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã số/SBD</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Điểm số (10)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thời gian nộp</th>
                            </tr>
                        </thead>
                        <tbody id="student-list" class="bg-white divide-y divide-gray-200">
                            <!-- Dữ liệu thí sinh sẽ được chèn vào đây -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- 3. GIAO DIỆN ĐỀ THI (THÍ SINH) -->
    <div id="exam-screen" class="screen flex-col">
        <!-- Header (Nav Bar) -->
        <header class="flex-shrink-0 bg-white shadow-md p-4">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="text-sm font-medium text-gray-700">
                    <p><span id="exam-ho_ten">...</span> | SBD: <span id="exam-sbd">...</span></p>
                    <p>Môn thi: <span class="font-bold text-blue-600" id="exam-subject-display">HÓA HỌC</span> | Kỳ thi: THPT 2026</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 text-xl font-bold text-red-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span id="timer">50:00</span>
                    </div>
                    <button onclick="confirmSubmission()" class="btn-primary py-2 px-4">NỘP BÀI</button>
                </div>
            </div>
        </header>

        <!-- Nội dung thi -->
        <main class="flex-grow p-4 overflow-hidden">
            <div class="max-w-7xl mx-auto h-full flex exam-layout">
                <!-- Khu vực đề thi (trái) -->
                <div id="exam-content" class="w-3/4 question-content pr-4 h-full exam-panel">
                    <div class="flex justify-between items-center mb-4">
                        <div class="space-x-2">
                            <button onclick="prevQuestion()" class="btn-secondary px-4">Quay lại</button>
                            <button onclick="nextQuestion()" class="btn-primary px-4">Tiếp theo</button>
                        </div>
                        <span class="text-lg font-semibold text-gray-700">Số câu đã trả lời: <span id="answered-count">0</span>/<span id="total-questions">28</span></span>
                    </div>
                    
                    <!-- Vùng hiển thị câu hỏi -->
                    <div id="question-container" class="card p-6 min-h-[400px]">
                        <div class="text-center text-gray-500">Đang tải đề thi...</div>
                    </div>
                </div>

                <!-- Thanh điều hướng câu hỏi (phải) -->
                <div class="w-1/4 question-navigation flex-shrink-0 pl-4">
                    <div class="card p-4 h-full flex flex-col">
                        <h3 class="font-bold text-lg mb-3">BẢNG ĐIỀU HƯỚNG</h3>
                        
                        <div id="question-nav" class="flex flex-col gap-4 overflow-y-auto exam-panel">
                            <!-- Nội dung được thêm bằng JS -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Modal xác nhận nộp bài -->
        <div id="submission-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 modal">
            <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm modal-content">
                <h3 class="text-xl font-bold mb-4">Xác nhận nộp bài</h3>
                <p class="mb-6">Bạn có chắc chắn muốn nộp bài không? Thời gian còn lại sẽ bị hủy.</p>
                <div class="flex justify-end space-x-4">
                    <button onclick="hideSubmissionModal()" class="btn-secondary">Hủy</button>
                    <button onclick="submitExam()" class="btn-primary">Nộp bài</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. GIAO DIỆN KẾT QUẢ -->
    <div id="result-screen" class="screen flex-col items-center justify-center p-4">
        <h1 class="text-3xl font-bold mb-10 text-gray-800">GIAO DIỆN KẾT QUẢ THI</h1>
        <div class="card result-box p-8 w-full max-w-lg text-center border-4 border-green-700">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">Kết quả thi</h2>
            <div class="text-left space-y-3 text-lg">
                <p class="font-bold text-green-700">Bạn đã nộp bài thi thành công!</p>
                <p><span class="font-medium">Tổng số câu trả lời:</span> <span id="result-answered"></span>/<span id="result-total"></span></p>
                <p><span class="font-medium">Số câu đúng:</span> <span id="result-correct"></span></p>
                <p class="text-2xl font-bold text-blue-700"><span class="font-medium">Số điểm đạt được:</span> <span id="result-score"></span>/10</p>
            </div>
            
            <button onclick="changeScreen('login-screen')" class="btn-primary mt-8 px-8 py-3">Hoàn thành</button>
        </div>
    </div>
    
    <!-- Modal chọn Sub-môn -->
    <div id="subject-option-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 modal">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm modal-content">
            <h3 class="text-xl font-bold mb-4" id="modal-subject-title">Chọn tùy chọn</h3>
            <div id="modal-options-container" class="space-y-3">
                <!-- Options will be dynamically inserted here -->
            </div>
            <div class="flex justify-end space-x-4 mt-6">
                <button onclick="hideSubjectOptionModal()" class="btn-secondary">Hủy</button>
            </div>
        </div>
    </div>


    <script>
        // --- KHAI BÁO BIẾN TOÀN CỤC ---
        const ADMIN_CODE = '22122007';
        const ADMIN_PASS = 'Huuhuy@2212_admin_chemistry';
        const STUDENT_PASS = 'HOA2026T12';
        const STORAGE_KEY = 'exam_student_results';
        
        let currentScreen = 'login-screen';
        let currentQuestionIndex = 0;
        let timerInterval = null;
        let userInfo = { ho_ten: '', ma_thi_sinh: '' };
        let timeLeft = 0; 
        
        // Dữ liệu đề thi Hóa học mẫu
        const EXAM_DATA = {
            subject: "HÓA HỌC",
            timeLimit: 50 * 60, // 50 phút
            totalQuestions: 28,
            points: {
                P1: { count: 18, total: 4.5, perQ: 4.5 / 18 }, // 0.25 điểm/câu
                P2: { count: 4, total: 4.0, perQ: 1.0 }, // 1.0 điểm/câu
                P3: { count: 6, total: 1.5, perQ: 1.5 / 6 }, // 0.25 điểm/câu
            },
            questions: [
                { id: 1, section: "Phần I", text: "Độ dinh dưỡng của phân lận được đánh giá bằng hàm lượng phần trăm nào tương ứng với lượng phosphorus có trong thành phần của nó?", options: ["P", "P2O", "P2O5", "PO2"], answer: "P2O5", selected: null },
                { id: 2, section: "Phần I", text: "Những tính chất vật lí chung của kim loại (dẫn điện, dẫn nhiệt, dẻo, ánh kim) gây nên bởi?", options: ["các electron tự do trong mạng tinh thể kim loại.", "kiểu cấu tạo mạng tinh thể kim loại.", "khối lượng riêng của kim loại.", "tính chất của kim loại."], answer: "các electron tự do trong mạng tinh thể kim loại.", selected: null },
                { id: 3, section: "Phần I", text: "Nguyên tắc điều chế kim loại là", options: ["khử ion kim loại thành nguyên tử.", "oxi hóa ion kim loại thành nguyên tử.", "khử nguyên tử kim loại thành ion.", "oxi hóa nguyên tử kim loại thành ion."], answer: "khử ion kim loại thành nguyên tử.", selected: null },
                { id: 4, section: "Phần I", text: "Liên kết hoá học chủ yếu trong hợp kim là", options: ["liên kết kim loại hoặc liên kết cộng hoá trị.", "liên kết cộng hoá trị và liên kết ion.", "liên kết ion và tương tác yếu giữa các phân tử (tương tác VanderWaals).", "tương tác yếu giữa các phân tử (tương tác VanderWaals) và liên kết kim loại."], answer: "liên kết kim loại hoặc liên kết cộng hoá trị.", selected: null },
                { id: 5, section: "Phần I", text: "Quá trình oxi hóa khử, các electron kim loại được chuyển trực tiếp đến các chất trong môi trường là sự", options: ["Ăn mòn", "Ăn mòn hóa học", "Ăn mòn điện hóa", "Ăn mòn kim loại"], answer: "Ăn mòn hóa học", selected: null },
                { id: 6, section: "Phần I", text: "Sắp xếp các cặp oxi - hóa khử Fe2+/Fe; Cu2+/Cu; Fe3+/Fe2+ theo thứ tự tăng dần thế điện cực chuẩn?", options: ["Fe2+/Fe; Cu2+/Cu; Fe3+/Fe2+.", "Fe3+/Fe2+; Cu2+/Cu; Fe2+/Fe.", "Cu2+/Cu; Fe2+/Fe; Fe3+/Fe2+.", "Cu2+/Cu; Fe3+/Fe2+; Fe2+/Fe."], answer: "Fe2+/Fe; Cu2+/Cu; Fe3+/Fe2+.", selected: null },
                { id: 7, section: "Phần I", text: "Diêm tiêu kali có công thức hóa học là", options: ["KNO3.", "K2CO3.", "KCl.", "K2SO4."], answer: "KNO3.", selected: null },
                { id: 8, section: "Phần I", text: "Hiện tượng “nước chảy đá mòn” và hiện tượng “xâm thực” của nước mưa vào các phiến đá vôi là do trong nước có hoà tan khí nào sau đây?", options: ["O2.", "N2.", "CH4.", "CO2."], answer: "CO2.", selected: null },
                { id: 9, section: "Phần I", text: "Thành phần chính của lớp cặn bám vào ấm đun nước lâu ngày là", options: ["CaO.", "NaCl.", "Ca(OH)2.", "CaCO3."], answer: "CaCO3.", selected: null },
                { id: 10, section: "Phần I", text: "Trong nông nghiệp, trộn urea hoặc phân đạm ammonium với chất nào sau đây thì sẽ làm giảm đáng kể tác dụng của phân đạm?", options: ["KNO3.", "Ca(H2PO4)2.", "Ca(OH)2.", "CaCl2."], answer: "Ca(OH)2.", selected: null },
                { id: 11, section: "Phần I", text: "Khi kết thúc phản ứng, số thí nghiệm thu được kết tủa là: (1) Sục khí CO2 dư vào dung dịch Ca(OH)2. (2) Cho dung dịch NaOH dư vào dung dịch Ba(HCO3)2. (3) Đun sôi một mẫu nước có tính cứng tạm thời. (4) Cho dung dịch KHSO4 vào dung dịch Ba(OH)2.", options: ["4.", "3.", "2.", "1."], answer: "3.", selected: null },
                { id: 12, section: "Phần I", text: "Để làm mềm nước giếng chứa Ca2+, Mg2+, HCO3-, Cl-, SO42-, cần sử dụng hóa chất nào sau đây?", options: ["Na2CO3.", "HCl.", "H2SO4.", "NaHCO3."], answer: "Na2CO3.", selected: null },
                { id: 13, section: "Phần I", text: "Ống (1) chứa CaCl2, ống (2) chứa BaCl2. Nhỏ CuSO4, thấy ống (1) xuất hiện kết tủa chậm hơn và ít hơn so với ống (2). Nhận định nào sau đây đúng khi so sánh CaSO4 với BaSO4?", options: ["Khó nhiệt phân hơn.", "Khó thuỷ phân hơn.", "Dễ kết tủa hơn.", "Dễ tan hơn."], answer: "Dễ tan hơn.", selected: null },
                { id: 14, section: "Phần I", text: "Các kim loại chuyển tiếp dãy thứ nhất có đặc điểm chung nào sau đây về cấu hình electron?", options: ["Đều có lớp vỏ bên trong của khí hiếm Ar (Z=18).", "Đều có phân lớp 3d bão hòa electron.", "Đều có 2 electron trên phân lớp 4s.", "Đều có số electron hóa trị nhỏ hơn 6."], answer: "Đều có lớp vỏ bên trong của khí hiếm Ar (Z=18).", selected: null },
                { id: 15, section: "Phần I", text: "Số trường hợp Fe phản ứng với các dung dịch Al2(SO4)3, FeCl3, AgNO3, Na2SO4, MgCl2, Cu(NO3)2 là", options: ["1.", "4.", "3.", "2."], answer: "2.", selected: null },
                { id: 16, section: "Phần I", text: "Liên kết giữa phối tử và nguyên tử trung tâm là liên kết", options: ["Cộng hóa trị.", "Cho - nhận.", "Ion", "Kim loại."], answer: "Cho - nhận.", selected: null },
                { id: 17, section: "Phần I", text: "Kim loại chuyển tiếp dãy thứ nhất nào sau đây được ứng dụng để chế tạo hợp kim không gỉ hoặc siêu cứng?", options: ["Cu.", "Cr.", "Fe.", "Co."], answer: "Cr.", selected: null },
                { id: 18, section: "Phần I", text: "Công thức hoá học của phức chất aqua của ion Mn2+ và ion Co3+. Biết chúng đều có dạng hình học bát diện?", options: [" [Mn(H2O)6]2+ và [Co(H2O)6]3+", " [Mn(H2O)6]4+ và [Co(H2O)6]6+", " [Mn(H2O)4]2+ và [Co(H2O)6]3+", " [Mn(H2O)6]2+ và [Co(H2O)3]3+"], answer: " [Mn(H2O)6]2+ và [Co(H2O)6]3+", selected: null },
                { id: 19, section: "Phần II", text: "Câu 1. Về Maltose. Chọn phương án chứa CÁC Ý ĐÚNG: (a) CTPT C12H22O11. (b) Có khả năng phản ứng Tollens. (c) Nhóm –OH ở vị trí C1 và C4 là nhóm –OH hemiacetal. (d) Giá trị m kết tủa thu được là 1555,2g (từ 34.2kg dd 60% Maltose).", options: ["(a) và (b)", "(a), (b), và (d)", "(a), (b), (c)", "Không có đáp án nào"], answer: "(a), (b), và (d)", selected: null },
                { id: 20, section: "Phần II", text: "Câu 2. Về phức chất nitơ (A2) của Ruteni(II): (a) Phương trình: [Ru(NH3)5H2O]2+ + N2 → [Ru(NH3)5(N2)]2+ + H2O. (b) Số oxi hóa và hóa trị của Ru trong A2 là 0. (c) Cấu hình Ru2+: [Kr]4d75s3. (d) Trạng thái lai hóa của ion trung tâm là sp3d2 vì phức chất có tính thuận từ. ", options: ["(a) và (d)", "(a), (b), và (d)", "Chỉ (a)", "Tất cả đều sai"], answer: "Chỉ (a)", selected: null }, 
                { id: 21, section: "Phần II", text: "Câu 3. Về Breathalyzer và nồng độ cồn: (a) Ethanol được hấp thụ vào cơ thể thông qua hệ tiêu hóa. (b) Tổng hệ số sau cân bằng phản ứng (*) là 30. (c) Mẫu khí thở 26.25mL có 0.056mg K2Cr2O7 p/ứ vi phạm mức phạt (6-8 triệu). (d) Sản xuất đồ uống có cồn phổ biến là hydrate hóa alkene.", options: ["(a) và (c)", "(a) và (d)", "Chỉ (c)", "(a), (b), (c), (d)"], answer: "(a) và (c)", selected: null }, 
                { id: 22, section: "Phần II", text: "Câu 4. Về sơ đồ phản ứng chuỗi hóa học: (a) X5 (CH3COOH) hòa tan Cu(OH)2 tạo dung dịch màu xanh. (b) X6 (C2H2) có phản ứng AgNO3/NH3 tạo kết tủa trắng bạc. (c) Đốt 1,5 mol X7 (CH3CHO) cần 3 mol O2. (d) X là ester no, đơn chức C2H5COOCH3.", options: ["(a), (c) và (d)", "Chỉ (d)", "Tất cả đều sai", "Không có đáp án nào"], answer: "Tất cả đều sai", selected: null }, 
                { id: 23, section: "Phần III", text: "Sản xuất 3,6 triệu viên nén aspirin (100mg/viên, H=80%) cần m kg salicylic acid (C7H6O3). Giá trị của m bằng bao nhiêu? (làm tròn đến hàng đơn vị)", options: ["400", "500", "600", "700"], answer: "500", selected: null },
                { id: 24, section: "Phần III", text: "Thí nghiệm điều chế isoamyl acetate. Số phát biểu ĐÚNG là: (1) CTPT CH3COOCH2CH2CH(CH3)2. (2) Phân tử nước tạo thành từ OH của alcohol và H của acid. (3) NaHCO3 trung hòa acid. (4) NaCl bão hòa để ester không bị thủy phân. (5) Ở bước 4, chiết loại bỏ chất lỏng phía trên (là ester). (6) Lắp thêm ống sinh hàn thẳng đứng để hạn chế thất thoát. (Gợi ý: Số ý đúng là 4)", options: ["2", "3", "4", "5"], answer: "4", selected: null }, 
                { id: 25, section: "Phần III", text: "Cho sơ đồ E, F, X (Cùng CTPT đơn giản nhất CH2O, ME < MF < 100). Số phát biểu ĐÚNG là: (a) Chất X có phân tử khối bằng 68. (b) Từ chất Y điều chế trực tiếp được acetic acid. (c) Oxi hóa Z bằng CuO, thu được acetic aldehyde. (d) Chất F làm quỳ tím chuyển thành màu đỏ. (e) Chất T có nhiệt độ sôi lớn hơn ethyl alcohol. (Gợi ý: Số ý đúng là 3)", options: ["1", "2", "3", "4"], answer: "3", selected: null }, 
                { id: 26, section: "Phần III", text: "Sản xuất 100 tấn phân NPK (15 – 15 – 15) bằng 98 tấn hỗn hợp Amophos (16-48-0), SA (21%), Ure (46%), Kali (60%). Khối lượng phân bón Ure đã sử dụng (tấn)? (Làm tròn đến hàng đơn vị)", options: ["12", "15", "18", "21"], answer: "18", selected: null },
                { id: 27, section: "Phần III", text: "Số đồng phân cấu tạo của ester C5H10O2 là", options: ["6", "7", "8", "9"], answer: "9", selected: null },
                { id: 28, section: "Phần III", text: "Xác định số phối trí trong các phức sau, điền theo thứ tự (c), (b), (a): (a) [Cu(en)2]2+ (b) [Fe(C2O4)3]3- (c) [CoCl(SCN)(en)2]+. (Gợi ý: Phối trí là 6, 6, 4).", options: ["664", "666", "466", "446"], answer: "664", selected: null }, 
            ]
        };

        // --- DỮ LIỆU MÔN HỌC (SỬ DỤNG CHO Subject Selection Screen) ---
        const ALL_SUBJECTS = [
            'Ngữ văn', 'Toán', 'Vật lý', 
            { name: 'Hóa học', status: 'ready', type: 'single' }, // Chỉ có Hóa học là READY
            'Sinh học', 'Lịch sử', 'Địa lý', 
            'Giáo dục kinh tế và pháp luật', 'Tin học',
            { name: 'Công nghệ', type: 'options', options: ['Công nghiệp', 'Nông nghiệp'] },
            { name: 'Ngoại ngữ', type: 'options', options: ['Tiếng Anh', 'Tiếng Nga', 'Tiếng Pháp', 'Tiếng Trung Quốc', 'Tiếng Đức', 'Tiếng Nhật', 'Tiếng Hàn'] }
        ];

        // --- XỬ LÝ DỮ LIỆU SAU KHAI BÁO ---
        timeLeft = EXAM_DATA.timeLimit;
        EXAM_DATA.questions = EXAM_DATA.questions.map(q => {
            const sectionData = q.section === "Phần I" ? EXAM_DATA.points.P1 : q.section === "Phần II" ? EXAM_DATA.points.P2 : EXAM_DATA.points.P3;
            return {
                ...q,
                correctIndex: q.options.indexOf(q.answer),
                pointValue: sectionData.perQ,
                section: q.section,
            };
        });

        // --- HÀM CHUNG ---
        function changeScreen(newScreenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active-screen');
                screen.style.display = 'none';
            });
            const newScreen = document.getElementById(newScreenId);
            newScreen.classList.add('active-screen');
            newScreen.style.display = 'flex';
            currentScreen = newScreenId;

            if (newScreenId === 'exam-screen') {
                initializeExam();
                startTimer();
            } else if (newScreenId === 'subject-selection-screen') {
                document.getElementById('info-ho_ten').textContent = userInfo.ho_ten || '...';
                document.getElementById('info-sbd').textContent = userInfo.ma_thi_sinh || '...';
                renderSubjectList(); // Hiển thị danh sách môn học mở rộng
            } else if (newScreenId === 'admin-screen') {
                loadStudentResults();
            } else {
                stopTimer();
            }
        }

        // --- 1. Logic Đăng nhập (Admin/Thí sinh) ---
        function login() {
            const maSo = document.getElementById('ma_thi_sinh').value.trim();
            const hoTen = document.getElementById('ho_ten').value.trim();
            const matKhau = document.getElementById('mat_khau').value;
            const errorElement = document.getElementById('login-error');

            // 1. Kiểm tra Admin
            if (maSo === ADMIN_CODE && matKhau === ADMIN_PASS) {
                errorElement.classList.add('hidden');
                alert("Đăng nhập Admin thành công!");
                changeScreen('admin-screen');
                return;
            }

            // 2. Kiểm tra Thí sinh
            if (matKhau === STUDENT_PASS) {
                errorElement.classList.add('hidden');
                userInfo.ho_ten = hoTen || 'Thí sinh ẩn danh';
                userInfo.ma_thi_sinh = maSo || '00000000'; 
                changeScreen('subject-selection-screen');
                return;
            }

            // 3. Đăng nhập thất bại
            errorElement.classList.remove('hidden');
        }

        // --- 2. Logic Chọn đề thi (Thí sinh) ---

        function renderSubjectList() {
            const container = document.getElementById('subject-list');
            container.innerHTML = ALL_SUBJECTS.map(subject => {
                const name = typeof subject === 'string' ? subject : subject.name;
                const type = typeof subject === 'string' ? 'disabled' : subject.type;
                const status = subject.status === 'ready';

                let buttonHtml;
                if (status) {
                    buttonHtml = `<button onclick="startExam('${name}')" class="btn-primary py-1 px-4 text-sm">Vào thi</button>`;
                } else if (type === 'options') {
                    buttonHtml = `<button onclick="showSubjectOptionModal('${name}', ${JSON.stringify(subject.options)})" class="btn-primary py-1 px-4 text-sm bg-purple-500 hover:bg-purple-600">Chọn môn</button>`;
                } else {
                    buttonHtml = `<button class="btn-secondary py-1 px-4 text-sm cursor-not-allowed" disabled>Vào thi</button>`;
                }

                const cardClass = status ? 'bg-white border-blue-400' : 
                                  type === 'options' ? 'bg-purple-50 border-purple-400' : 'bg-gray-200 border-gray-300 opacity-70';

                return `
                    <div class="flex justify-between items-center p-3 border rounded-md ${cardClass}">
                        <span class="font-medium text-gray-700">${name}</span>
                        ${buttonHtml}
                    </div>
                `;
            }).join('');
        }

        function showSubjectOptionModal(subjectName, options) {
            const modal = document.getElementById('subject-option-modal');
            const title = document.getElementById('modal-subject-title');
            const container = document.getElementById('modal-options-container');

            title.textContent = `Chọn môn ${subjectName}:`;
            container.innerHTML = options.map(option => `
                <button onclick="startExam('${subjectName} (${option})')" class="btn-primary w-full py-2 bg-indigo-500 hover:bg-indigo-600 text-sm">
                    ${option}
                </button>
            `).join('');

            modal.classList.remove('hidden');
            modal.classList.add('open');
        }

        function hideSubjectOptionModal() {
            const modal = document.getElementById('subject-option-modal');
            modal.classList.remove('open');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        function startExam(subjectName) {
            if (subjectName.includes('Hóa học')) {
                document.getElementById('exam-ho_ten').textContent = userInfo.ho_ten;
                document.getElementById('exam-sbd').textContent = userInfo.ma_thi_sinh;
                document.getElementById('exam-subject-display').textContent = subjectName;
                hideSubjectOptionModal();
                changeScreen('exam-screen');
            } else {
                alert(`Môn "${subjectName}" hiện chưa có đề thi mẫu. Chỉ có Hóa học là sẵn sàng.`);
            }
        }
        
        // --- 2B. Logic Admin ---

        function loadStudentResults() {
            const rawData = localStorage.getItem(STORAGE_KEY);
            const results = rawData ? JSON.parse(rawData) : [];
            const container = document.getElementById('student-list');
            
            container.innerHTML = ''; // Clear previous data

            if (results.length === 0) {
                container.innerHTML = `<tr><td colspan="4" class="px-6 py-4 text-center text-gray-500">Chưa có thí sinh nào nộp bài.</td></tr>`;
                return;
            }

            results.forEach(student => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-lg font-bold text-blue-600">${student.score.toFixed(1)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(student.timestamp).toLocaleString('vi-VN')}</td>
                `;
                container.appendChild(row);
            });
        }

        function resetTestData() {
            if (confirm("Bạn có chắc chắn muốn xóa TẤT CẢ dữ liệu thí sinh và điểm số không?")) {
                localStorage.removeItem(STORAGE_KEY);
                alert("Dữ liệu thí sinh đã được xóa thành công!");
                loadStudentResults(); 
            }
        }

        // --- 3. Logic Đề thi ---
        function initializeExam() {
            currentQuestionIndex = 0;
            timeLeft = EXAM_DATA.timeLimit;
            EXAM_DATA.questions.forEach(q => q.selected = null);

            document.getElementById('total-questions').textContent = EXAM_DATA.totalQuestions;
            document.getElementById('answered-count').textContent = '0';
            updateQuestionNavigation();
            renderQuestion(currentQuestionIndex);
        }

        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                stopTimer();
                submitExam(true); 
            } else {
                timeLeft--;
            }
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            updateTimer(); 
            timerInterval = setInterval(updateTimer, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function renderQuestion(index) {
            const container = document.getElementById('question-container');
            const q = EXAM_DATA.questions[index];

            if (!q) {
                container.innerHTML = '<div class="text-center text-red-500">Không tìm thấy câu hỏi!</div>';
                return;
            }

            let optionsHtml = q.options.map((option, optIndex) => `
                <div class="mb-2 question-option">
                    <input type="radio" id="q${q.id}_opt${optIndex}" name="question${q.id}" value="${optIndex}" 
                        class="hidden" ${q.selected === optIndex ? 'checked' : ''}
                        onchange="handleAnswerChange(${index}, ${optIndex})">
                    <label for="q${q.id}_opt${optIndex}" class="flex items-start space-x-3">
                        <span class="font-bold text-blue-600 w-6 flex-shrink-0">${String.fromCharCode(65 + optIndex)}.</span>
                        <p>${option}</p>
                    </label>
                </div>
            `).join('');

            container.innerHTML = `
                <p class="section-title text-sm">${q.section}</p>
                <h2 class="text-xl font-bold mb-4 text-gray-800">Câu ${q.id}:</h2>
                <div class="mb-6 border-b pb-4 text-lg whitespace-pre-wrap">${q.text}</div>
                <div class="space-y-3">
                    ${optionsHtml}
                </div>
            `;
            
            document.querySelectorAll('#question-nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`nav-q-${q.id}`).classList.add('active');

            currentQuestionIndex = index;
        }

        function handleAnswerChange(qIndex, selectedIndex) {
            const q = EXAM_DATA.questions[qIndex];
            q.selected = selectedIndex;
            updateQuestionNavigation();
        }

        function nextQuestion() {
            const nextIndex = (currentQuestionIndex + 1) % EXAM_DATA.questions.length;
            renderQuestion(nextIndex);
        }
        
        function prevQuestion() {
            const prevIndex = (currentQuestionIndex - 1 + EXAM_DATA.questions.length) % EXAM_DATA.questions.length;
            renderQuestion(prevIndex);
        }

        function updateQuestionNavigation() {
            const navContainer = document.getElementById('question-nav');
            navContainer.innerHTML = '';
            let answeredCount = 0;
            
            const sections = {
                "Phần I": [],
                "Phần II": [],
                "Phần III": []
            };

            EXAM_DATA.questions.forEach(q => {
                if (q.selected !== null) answeredCount++;
                sections[q.section].push(q);
            });

            for (const section in sections) {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'mb-4';
                sectionDiv.innerHTML = `<h4 class="font-semibold text-gray-700 mb-2">${section} (${sections[section].length} câu)</h4>`;
                
                const buttonWrapper = document.createElement('div');
                buttonWrapper.className = 'flex flex-wrap gap-2';
                
                sections[section].forEach((q, indexInSection) => {
                    const globalIndex = EXAM_DATA.questions.findIndex(eq => eq.id === q.id);
                    const isAnswered = q.selected !== null;

                    const button = document.createElement('button');
                    button.id = `nav-q-${q.id}`;
                    button.className = `question-nav-item w-10 h-10 rounded-full border border-gray-300 flex items-center justify-center text-sm transition-colors ${isAnswered ? 'answered' : 'bg-white text-gray-700'}`;
                    button.textContent = q.id;
                    button.onclick = () => renderQuestion(globalIndex);
                    buttonWrapper.appendChild(button);
                });

                sectionDiv.appendChild(buttonWrapper);
                navContainer.appendChild(sectionDiv);
            }

            document.getElementById('answered-count').textContent = answeredCount;
        }

        // Modal nộp bài
        function confirmSubmission() {
            document.getElementById('submission-modal').classList.remove('hidden');
            document.getElementById('submission-modal').classList.add('open');
        }

        function hideSubmissionModal() {
            const modal = document.getElementById('submission-modal');
            modal.classList.remove('open');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        // Nộp bài và tính điểm
        function submitExam(isAutoSubmit = false) {
            hideSubmissionModal();
            stopTimer();

            // 1. Tính toán kết quả
            let correctCount = 0;
            let answeredCount = 0;
            let finalScore = 0;

            EXAM_DATA.questions.forEach(q => {
                if (q.selected !== null) {
                    answeredCount++;
                    
                    if (q.selected === q.correctIndex) {
                        correctCount++;
                        finalScore += q.pointValue;
                    }
                }
            });

            const formattedScore = finalScore.toFixed(1);

            // 2. Lưu kết quả vào localStorage
            saveResult(userInfo.ho_ten, userInfo.ma_thi_sinh, formattedScore);

            // 3. Cập nhật giao diện kết quả
            document.getElementById('result-answered').textContent = answeredCount;
            document.getElementById('result-total').textContent = EXAM_DATA.totalQuestions;
            document.getElementById('result-correct').textContent = correctCount;
            document.getElementById('result-score').textContent = formattedScore;

            // 4. Chuyển màn hình
            changeScreen('result-screen');
        }

        // --- Logic Lưu trữ (localStorage) ---

        function saveResult(name, id, score) {
            const rawData = localStorage.getItem(STORAGE_KEY);
            const results = rawData ? JSON.parse(rawData) : [];
            
            // Thêm kết quả mới
            results.push({
                name: name,
                id: id,
                score: parseFloat(score),
                timestamp: Date.now()
            });

            localStorage.setItem(STORAGE_KEY, JSON.stringify(results));
        }
        
        // Hàm chạy khi tải trang lần đầu
        window.onload = function() {
            changeScreen('login-screen');
        };

        // Gán sự kiện cho các nút điều hướng trong màn hình thi
        document.addEventListener('keydown', (e) => {
            if (currentScreen === 'exam-screen') {
                if (e.key === 'ArrowRight') {
                    nextQuestion();
                } else if (e.key === 'ArrowLeft') {
                    prevQuestion();
                }
            }
        });
    </script>

</body>
</html>